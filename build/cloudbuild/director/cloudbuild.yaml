# Cloud Build configuration for the Director service

steps:
# Build the Docker image from the project root
- name: "gcr.io/cloud-builders/docker"
  args: ["build", "-t", "asia-south1-docker.pkg.dev/$PROJECT_ID/salon-repo/director:latest", "-f", "services/director/Dockerfile.cloudbuild", "."]

# Push the Docker image to Artifact Registry
- name: "gcr.io/cloud-builders/docker"
  args: ["push", "asia-south1-docker.pkg.dev/$PROJECT_ID/salon-repo/director:latest"]

# Deploy the image to Cloud Run
- name: "gcr.io/cloud-builders/gcloud"
  args:
  - "run"
  - "deploy"
  - "director"
  - "--image"
  - "asia-south1-docker.pkg.dev/$PROJECT_ID/salon-repo/director:latest"
  - "--region"
  - "asia-south1"
  - "--platform"
  - "managed"
  - "--allow-unauthenticated"
  - "--set-env-vars"
  - "GOOGLE_CLOUD_PROJECT=$PROJECT_ID"

images:
- "asia-south1-docker.pkg.dev/$PROJECT_ID/salon-repo/director:latest"
