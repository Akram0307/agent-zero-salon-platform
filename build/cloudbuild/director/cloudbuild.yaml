steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-f', 'services/director/Dockerfile.cloudbuild', '-t', '{_IMAGE}', '.']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', '{_IMAGE}']
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: 'bash'
  args:
  - '-lc'
  - 'set -e; gcloud run deploy director --image={_IMAGE} --region={_REGION} --platform=managed --allow-unauthenticated'

images:
- '{_IMAGE}'

substitutions:
  _REGION: asia-south1
  _IMAGE: asia-south1-docker.pkg.dev/salon-autonomous-ai-467811/ai-apps/director:latest

timeout: '600s'
